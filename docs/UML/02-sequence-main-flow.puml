@startuml Flujo Principal - Solicitud de Asesor铆a
!theme plain
skinparam backgroundColor white
skinparam participantBackgroundColor lightblue
skinparam actorBackgroundColor lightcoral

title Secuencia: Solicitud y Aprobaci贸n de Asesor铆a

actor "Estudiante" as Student
actor "Profesor" as Professor
participant "Sistema Web" as System
participant "Advisory Request\nService" as RequestService
participant "Notification\nService" as NotificationService
participant "Email\nService" as EmailService
database "PostgreSQL" as DB
queue "Redis Queue" as Queue

== Creaci贸n de Solicitud ==

Student -> System : 1. Accede al formulario\nde solicitud
System -> Student : 2. Muestra materias y\nprofesores disponibles

Student -> System : 3. Env铆a solicitud\n(materia, profesor, fecha preferida)
System -> RequestService : 4. Crear solicitud
RequestService -> DB : 5. Guardar AdvisoryRequest\n(status: PENDING)
DB --> RequestService : 6. Solicitud creada

RequestService -> NotificationService : 7. Enviar notificaci贸n\nal profesor
NotificationService -> Queue : 8. Agregar job de email
Queue -> EmailService : 9. Procesar env铆o
EmailService -> Professor : 10.  "Nueva solicitud\nde asesor铆a"

RequestService --> System : 11. Respuesta exitosa
System --> Student : 12. "Solicitud enviada\nsuccessfully"

== Revisi贸n y Aprobaci贸n ==

Professor -> System : 13. Accede al dashboard\nde solicitudes
System -> RequestService : 14. Obtener solicitudes\npendientes
RequestService -> DB : 15. Query solicitudes PENDING
DB --> RequestService : 16. Lista de solicitudes
RequestService --> System : 17. Datos de solicitudes
System --> Professor : 18. Muestra solicitudes\npendientes

Professor -> System : 19. Aprueba solicitud\ncon mensaje
System -> RequestService : 20. Aprobar solicitud
RequestService -> DB : 21. Actualizar status\na APPROVED

RequestService -> DB : 22. Crear Advisory y\nAdvisoryDate
DB --> RequestService : 23. Sesi贸n programada

RequestService -> NotificationService : 24. Notificar aprobaci贸n\nal estudiante
NotificationService -> Queue : 25. Job de confirmaci贸n
Queue -> EmailService : 26. Enviar confirmaci贸n
EmailService -> Student : 27.  "Solicitud aprobada\nSesi贸n programada"

RequestService --> System : 28. Aprobaci贸n exitosa
System --> Professor : 29. "Solicitud aprobada\ny sesi贸n creada"

== Realizaci贸n de Sesi贸n ==

note over Student, Professor : El d铆a de la sesi贸n programada

Professor -> System : 30. Registrar asistencia
System -> RequestService : 31. Marcar asistencia
RequestService -> DB : 32. Crear AdvisoryAttendance
RequestService -> DB : 33. Actualizar estado\na COMPLETED

RequestService -> NotificationService : 34. Notificar finalizaci贸n
NotificationService -> Queue : 35. Job de seguimiento
Queue -> EmailService : 36. Enviar resumen
EmailService -> Student : 37.  "Sesi贸n completada\nResumen de asesor铆a"

note right of DB : La base de datos mantiene\nel historial completo de\ntodas las interacciones

@enduml